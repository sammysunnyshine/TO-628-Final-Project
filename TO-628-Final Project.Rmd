---
title: "TO 628 Final Project: Spotify Hits Data"
author: "Team 8: MBAi"
date: "4/4/2023"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    theme: readable
    highlight: tango
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Intermediate deliverable

## Link to GitHub repo

## Dataset Details

## Business Question

## Read and Clean Data
```{r}
spot <- read.csv("spotify_hits.csv")

spot$uri <- NULL

# Delete the tracks field because it's essentially individual IDs
spot$track <- NULL

# Deleting artist - too many unique values
spot$artist <- NULL

# There are no NA values
# There is no need to create factors

str(spot)
summary(spot)

```

See code comments for details on cleaning. Dummy variables are not needed.

## Randomize the Dataset
```{r}
spot_random <- spot[sample(1:nrow(spot)), ]
```

## Normalize the Data
```{r}
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

spot_norm <- as.data.frame(lapply(spot_random, normalize))
```

## Split Test and Train
```{r}
set.seed(12345)
test_set <- sample(1:nrow(spot_norm), 0.5*nrow(spot_norm))
spot_test <- spot_norm[test_set, ]
spot_train <- spot_norm[-test_set, ]

```

Created spot_test and spot_train with a 50/50 random sample.

## Build Regression Model
```{r}
model_lr <- glm(target ~ ., family = "binomial", data = spot_train)
summary(model_lr)

```

Nine variables are significant: 

- Danceability
- Energy
- Loudness
- Mode
- Acousticness
- Instramentalness
- Liveness
- Valence
- Time_signature

Six variables are not significant:

- Key
- Speechiness
- Tempo
- Duration_ms
- Chorus Hit
- Sections

## Predict Test Data
```{r}
spot_pred <- predict(model_lr, spot_test, type = "response")

summary(spot_pred)

spot_bin_pred <- ifelse(spot_pred >= 0.5, 1, 0)

table(spot_bin_pred)

```
Based on a 50% prediction threshold, the model predicts that of the `r 1253 + 1653` observations in the test data set, 1653 songs will be hits (`r round(100*1653/(1283+1653),0)` percent) and 1283 songs will be flops (`r round(100*1283/(1283+1653),0)` percent). 

## Evaluate Model
```{r}
library(caret)
confusionMatrix(as.factor(spot_bin_pred), as.factor(spot_test$target), positive = "1")

```

The model has an accuracy of 82.43% and a Kappa of 64.74%.

