---
title: "TO 628 Final Project: Spotify Hits Data"
author: "Team 8: MBAi"
date: "4/4/2023"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    theme: readable
    highlight: tango
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Intermediate deliverable

## Link to GitHub repo

## Dataset Details

## Business Question

## Read and Clean Data
```{r}
spot <- read.csv("spotify_hits.csv")

spot$uri <- NULL

# Because tracks are essentially individual IDs, I'm deleting that field
spot$track <- NULL

spot$artist <- as.factor(spot$artist)

# This factor has WAY too many levels - we need to fix (same problem as movies)
# Deleting the artist field for now to run the model, but we can put it back in

spot$artist <- NULL

# There are no NA values

str(spot)
summary(spot)

```

See code comments for details on cleaning.

## Create Dummy Variables
```{r}
spot_mm <- as.data.frame(model.matrix(~.-1, data = spot))
# "-1" removes the intercept column

# Dummy variables no longer need to be created if we're removing the factors, but this doesn't change anything else

# str(spot_mm)

```

## Shuffle the Dataset
```{r}
spot_mm <- spot_mm[sample(1:nrow(spot_mm)), ]
```


## Split Test and Train
```{r}
set.seed(12345)
test_set <- sample(1:nrow(spot_mm), 0.5*nrow(spot_mm))
spot_test <- spot_mm[test_set, ]
spot_train <- spot_mm[-test_set, ]

```

Created spot_test and spot_train with a 50/50 random sample.

## Build Regression Model
```{r}
model_lr <- glm(target ~ ., family = "binomial", data = spot_train)
summary(model_lr)

```

Ten variables are significant: 

- Danceability
- Energy
- Loudness
- Mode
- Acousticness
- Instramentalness
- Valence
- Tempo
- Duration_ms
- Time_signature

Five variables are not significant:

- Key
- Speechiness
- Liveness
- Chorus Hit
- Sections

## Predict Test Data
```{r}
spot_pred <- predict(model_lr, spot_test, type = "response")

summary(spot_pred)

spot_bin_pred <- ifelse(spot_pred >= 0.5, 1, 0)

table(spot_bin_pred)

```
The model predicts that of the `r 1310 + 1626` observations in the test data set, 1626 songs will be hits (`r round(100*1626/(1310+1626),0)` percent) and 1310 songs will be flops (`r round(100*1310/(1310+1626),0)` percent). 

## Evaluate Model
```{r}
library(caret)
confusionMatrix(as.factor(spot_bin_pred), as.factor(spot_test$target), positive = "1")

```

The model has an accuracy of 82.25% and a Kappa of 64.4%.

